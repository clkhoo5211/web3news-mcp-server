name: Deploy to Vercel (Optional)

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # Allow manual triggering

jobs:
  deploy:
    runs-on: ubuntu-latest
    # Only run if Vercel token is configured (optional workflow)
    # Note: If secret is not set, job will be skipped automatically
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install Vercel CLI
      run: npm install --global vercel@latest

    - name: Pull Vercel Environment Information
      run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
      continue-on-error: true
      env:
        VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    - name: Build Project
      run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
      continue-on-error: true
      env:
        VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    - name: Deploy Project to Vercel
      run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
      continue-on-error: true
      env:
        VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    - name: Deployment Summary
      if: success()
      run: |
        echo "‚úÖ Deployment completed successfully"
        echo "üöÄ Your MCP server is live on Vercel"

  skip-deploy:
    runs-on: ubuntu-latest
    if: failure()
    steps:
    - name: Skip Deployment
      run: |
        echo "‚ÑπÔ∏è  Vercel token not configured - skipping GitHub Actions deployment"
        echo "‚úÖ Vercel will auto-deploy on push (if connected in Vercel dashboard)"
        echo "üìù To enable GitHub Actions deployment, add VERCEL_TOKEN secret"

